<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"    
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:composition template="./../adminTemplate.xhtml">
        <ui:define name="content">
            <ol class="breadcrumb">
                <i class="fa fa-dashboard"/>               
                <li><a href="../Dashboard/Dashboard.xhtml">Dashboard</a></li>
                <li class="active">Pedidos</li>
            </ol>
            <b:container fluid="true">
                <b:row>
                    <!--                    <b:column col-lg="12">
                                            <div align="center">
                                                <h3>Pedidos<small> Listado de Pedidos segun usuario.</small></h3>                            
                                            </div>
                                        </b:column>-->

                    <h:form id="formularioRegistro">  
                        <c:choose>
                            <c:when test="#{pedidoCT.vista == 0}">
                                <b:column col-lg="12" col-md="12" col-sm="12" col-xs="12">
                                    <p:messages id="messages" closable="true"/>
                                </b:column>

                                <b:column col-lg="4" col-md="4" col-sm="12" col-xs="12">
                                    <b:column col-lg="12" col-md="12" col-sm="12" col-xs="12">
                                        <div class="box">
                                            <div class="box-header" align="center">
                                                <p class="box-title"><strong>Fecha</strong></p>
                                            </div>
                                            <div class="box-body" align="right">                                            
                                                <b:dateTimePicker style="width: 100%" show-time="false" mode="inline"/>                                            
                                            </div>
                                        </div>
                                    </b:column>    

                                    <b:column col-lg="12" col-md="12" col-sm="6" col-xs="6">
                                        <div class="box">
                                            <div class="box-header with-border" align="center">
                                                <p class="box-title"><strong>Pedidos</strong></p>
                                            </div>
                                            <div class="box-body" align="center">                                                
                                                <p:knob foregroundColor="#04B486" backgroundColor="#00000" disabled="true" max="25" step="1" value="#{pedidoCT.pedidos.size()}" />   
                                            </div>
                                        </div>
                                    </b:column>

                                    <b:column col-lg="12" col-md="12" col-sm="6" col-xs="6">
                                        <div class=" box">
                                            <div class="box-header" align="center">
                                                <p class="box-title"><strong>Calificaciones</strong></p>
                                            </div>
                                            <div class="box-body" align="center" >
                                                <p:commandButton style="width: 80%" ajax="false" immediate="true" action="Calificaciones" value="Calificaciones" icon="fa fa-arrow-right" iconPos="right" class="btn btn-success">
                                                </p:commandButton>
                                            </div>
                                        </div>
                                    </b:column>
                                </b:column>                                

                                <b:column col-lg="8" col-md="8" col-sm="12" col-xs="12">                                      
                                    <div class="box">
                                        <div class="box-header with-border" align="center">
                                            <h4 class="box-title"><strong>Pedidos</strong></h4>
                                        </div>
                                        <div class="box-body">
                                            <p:inputText class="form-control" value="#{pedidoCT.buscar}" style="width: 100%" type="text" placeholder="Buscar...">
                                                <p:ajax event="keyup" listener="#{pedidoCT.buscarPedido()}" update="DTPedidos"/>
                                            </p:inputText><hr/>
                                            <p:dataScroller scrollHeight="500" id="DTPedidos" style="width: 100%;" chunkSize="4" value="#{pedidoCT.pedidos}" mode="inline" var="pedido">
                                                <b:column col-lg="6" col-md="6" col-xs="12" col-sm="12">    
                                                    <div class="table-responsive">

                                                        <div class="brdr bgc-fff pad-10 box-shad btm-mrg-20 property-listing-pv">
                                                            <div align="right">
                                                                <i class="fa fa-2x fa-tag"></i>
                                                            </div>
                                                            <div>
                                                                <h5>Pedido N째: <small> #{pedido.idPedido} </small></h5>                                                                
                                                            </div>

                                                            <div class="media">                                                               
                                                                <div class="col-lg-12 col-md-12 col-sm-12">
                                                                    <div class="media-body fnt-smaller">
                                                                        <a href="#" target="_parent"></a>

                                                                        <h4 class="media-heading">
                                                                            <a href="#" target="_parent">$#{costoCT.consultarCostoPedido(pedido)} <small class="pull-right">#{pedido.direccionRecogida}</small></a></h4>
                                                                        <h4 class="media-heading"> Cliente: <small> #{pedido.usuario.nombre} #{pedido.usuario.apellido} </small></h4>
                                                                        <p class="hidden-xs">                                                                           
                                                                            <h:commandButton onclick="PrimeFaces.monitorDownload(start, stop);" style="width: 100%" value="Ver Pedido" class="btn btn-success btn-block">
                                                                                <p:ajax event="click" listener="#{pedidoCT.verPedido(pedido)}" update=":formularioRegistro"/>
                                                                            </h:commandButton>
                                                                        </p>
                                                                        <span class="fnt-smaller fnt-lighter fnt-arial">
                                                                            <div class="col-xs-6">
                                                                                <strong>Recibido: </strong> #{pedido.fechaRecogida}                                                                
                                                                            </div>
                                                                            <div class="col-xs-6">
                                                                                <strong>Entrega: </strong> #{pedido.fechaEntrega}                                                                                                                            
                                                                            </div>
                                                                        </span>
                                                                    </div>                                                    
                                                                </div>
                                                            </div>
                                                        </div><!-- End Listing--> 
                                                    </div>
                                                </b:column> 

                                            </p:dataScroller>
                                        </div>
                                    </div>    
                                </b:column>
                            </c:when>
                            <c:when test="#{pedidoCT.vista == 1}">
                                <b:column col-lg="12" col-md="12" col-sm="12" col-xs="12">
                                    <p:messages id="messages" closable="true"/>
                                </b:column>

                                <b:column col-lg="12" col-md="12" col-sm="12" col-xs="12">
                                    <div class="box box-success">
                                        <div class="box-header with-border">
                                            <i class="fa fa-2x fa-globe"/>
                                            <h4 class="box-title">Datos del Pedido</h4>
                                            <c:choose>
                                                <c:when test="#{sesionCT.obtenerSesion().rol.idRol == 2}">
                                                    <div class="box-tools">
                                                        <h:panelGrid columns="3">
                                                            <h:selectOneMenu class="form-control">
                                                                <f:selectItem itemLabel="Seleccione estado"/>
                                                            </h:selectOneMenu>
                                                            <p:commandButton icon="fa fa-pencil-square-o" iconPos="right" style="float: right" class="btn btn-success" value="Cambiar Estado"/>
                                                            <p:commandButton icon="fa fa-star" iconPos="right" style="float: right" class="btn btn-warning" value="Ver Calificacion"/>
                                                        </h:panelGrid>
                                                    </div>
                                                </c:when>
                                                <c:when test="#{sesionCT.obtenerSesion().rol.idRol == 4}">
                                                    <div class="box-tools">
                                                        <h:panelGrid columns="2">                                                        
                                                            <p:commandButton icon="fa fa-star" action="#{calificacionCT.verCalificacion(pedidoCT.pedido)}" iconPos="right" style="float: right" class="btn btn-warning" value="Calificar">
                                                                <f:setPropertyActionListener value="0" target="#{calificacionCT.vistaAnterior}"/>
                                                            </p:commandButton>
                                                        </h:panelGrid>
                                                    </div>
                                                </c:when>
                                            </c:choose>

                                        </div> 
                                        <div class="box-body">
                                            <div class="table-responsive">
                                                <!-- VISTA DE PEDIDO POR PERSONA-->
                                                <div class="brdr bgc-fff pad-10 box-shad btm-mrg-20 property-listing-pv">

                                                    <div class="media">
                                                        <div class="col-lg-4 col-md-4 col-sm-4">
                                                            <a class="pull-left" href="#" target="_parent">
                                                                <p:graphicImage alt="image" value="#{pedidoCT.pedido.usuario.rutaImagen}" height="100%" width="200px" class="img-responsive"/>
                                                            </a>                                                    
                                                        </div>

                                                        <div class="col-lg-8 col-md-8 col-sm-8">
                                                            <div class="media-body fnt-smaller">
                                                                <a href="#" target="_parent"></a>
                                                                <c:choose>
                                                                    <c:when test="#{pedidoCT.pedido.estado.idEstado == 3}">
                                                                        <div class="callout callout-info" >
                                                                            <i class=" fa fa-4x fa-tag"/>
                                                                            <h4 style="float:right; vertical-align: central">Servicio Solicitado</h4>
                                                                        </div>
                                                                    </c:when>
                                                                    <c:when test="#{pedidoCT.pedido.estado.idEstado == 4}">
                                                                        <div class="callout callout-success" >
                                                                            <i class=" fa fa-4x fa-check-square"/>
                                                                            <h4 style="float:right; vertical-align: central">Prendas Recibidas</h4>
                                                                        </div>
                                                                    </c:when>
                                                                    <c:when test="#{pedidoCT.pedido.estado.idEstado == 5}">
                                                                        <div class="callout callout-warning" >
                                                                            <i class=" fa fa-4x fa-building"/>
                                                                            <h4 style="float:right; vertical-align: central">En Planta</h4>
                                                                        </div>
                                                                    </c:when>
                                                                    <c:when test="#{pedidoCT.pedido.estado.idEstado == 6}">
                                                                        <div class="callout callout-info" >
                                                                            <i class=" fa fa-4x fa-tint"/>
                                                                            <h4 style="float:right; vertical-align: central">Lavado</h4>
                                                                        </div>
                                                                    </c:when>
                                                                    <c:when test="#{pedidoCT.pedido.estado.idEstado == 7}">
                                                                        <div class="callout callout-info" >
                                                                            <i class=" fa fa-4x fa-check"/>
                                                                            <h4 style="float:right; vertical-align: central">Entregado</h4>
                                                                        </div>
                                                                    </c:when>                                                                    
                                                                </c:choose>

                                                                <div>
                                                                    <h3>#{pedidoCT.pedido.usuario.nombre} #{pedidoCT.pedido.usuario.apellido} <small> N째 de Pedido: #{pedidoCT.pedido.idPedido}</small></h3>                            
                                                                </div>

                                                                <h4 class="media-heading">
                                                                    <small class="pull-left"><strong>Direcci처n Recogida: </strong>#{pedidoCT.pedido.direccionRecogida}
                                                                        <strong style="margin-left: 20px">Cel: </strong>#{pedidoCT.pedido.usuario.movil}
                                                                    </small>
                                                                </h4>

                                                                <br/>

                                                                <h4 class="media-heading">
                                                                    <small>
                                                                        <a href="#" target="_parent">$#{costoCT.consultarCostoPedido(pedidoCT.pedido)}</a>
                                                                    </small>
                                                                </h4>
                                                            </div>                                                    
                                                        </div>
                                                    </div>
                                                </div><!-- End Listing-->

                                                <div>
                                                    <h4 class="mrg-titles">Prendas del Pedido<small> N째 #{pedidoCT.pedido.idPedido}</small></h4>                            
                                                </div>

                                                <c:forEach items="#{descripcionPedidoCT.consultarDescripcionesSinFotosSegunPedido(pedidoCT.pedido)}" var="descripcion" begin="0" end="#{descripcionPedidoCT.consultarDescripcionesSinFotosSegunPedido(pedidoCT.pedido).size()}">
                                                    <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                                                        <!-- LISTA DE PRODUCTOS POR PEDIDOS-->
                                                        <div class="brdr bgc-fff pad-10 box-shad btm-mrg-20 property-listing-pv">
                                                            <div class="media">
                                                                <div class="col-lg-4 col-md-4 col-sm-4">
                                                                    <a class="pull-left" href="#" target="_parent">
                                                                        <p:graphicImage value="#{descripcion.subProducto.rutaImagen}" width="150px" height="150px"/>
                                                                    </a>                                                    
                                                                </div>

                                                                <div class="col-lg-8 col-md-8 col-sm-8">
                                                                    <div class="media-body fnt-smaller">
                                                                        <a href="#" target="_parent"></a>
                                                                        <div>
                                                                            <h3>#{descripcion.subProducto.nombre} 
                                                                                <small> 
                                                                                    <a href="#" target="_parent">$#{costoCT.consultarCostoSubProducto(descripcion.subProducto)}</a>
                                                                                </small>                                                                                
                                                                            </h3>                            
                                                                        </div>
                                                                        <p class="hidden-xs">#{descripcion.subProducto.descripcion}</p><span class="fnt-smaller fnt-lighter fnt-arial"></span>
                                                                        <p class="hidden-xs">#{descripcion.codigo}</p><span class="fnt-smaller fnt-lighter fnt-arial"></span>
                                                                        <div align="center">
                                                                            <p:commandButton onclick="PrimeFaces.monitorDownload(start, stop);" style="width: 60%" class="btn btn-primary btn-xs btn-block" value="Ver Prenda">
                                                                                <p:ajax event="click" listener="#{pedidoCT.verPrenda(descripcion)}" update=":formularioRegistro"/>
                                                                            </p:commandButton>
                                                                        </div>
                                                                    </div>                                                    
                                                                </div>
                                                            </div>
                                                        </div><!-- End Listing-->
                                                    </div>  
                                                </c:forEach>
                                            </div>
                                        </div>
                                        <div class="box box-footer" align="left">
                                            <p:commandButton icon="fa fa-arrow-left" onclick="PrimeFaces.monitorDownload(start, stop);" 
                                                             action="#{pedidoCT.volverPedidos()}" update=":formularioRegistro" value="Regresar" style="width: 20%" class="btn btn-info"/>
                                        </div>
                                    </div>
                                </b:column>    
                            </c:when>
                            <c:when test="#{pedidoCT.vista == 2}">
                                <b:column col-lg="12" col-md="12" col-sm="12" col-xs="12">
                                    <div class="box box-default">
                                        <div class="box-header with-border">
                                            <c:if test="#{sesionCT.obtenerSesion().rol.idRol == 2}">
                                                <div class="box-tools">
                                                    <h:panelGrid columns="2">
                                                        <h:selectOneMenu class="form-control">
                                                            <f:selectItem itemLabel="Seleccione estado"/>
                                                        </h:selectOneMenu>
                                                        <p:commandButton icon="fa fa-pencil-square-o" iconPos="right" style="float: right" class="btn btn-warning" value="Cambiar Estado"/>
                                                    </h:panelGrid>
                                                </div>
                                            </c:if>
                                        </div>
                                        <div class="box-body">                                            
                                            <b:column offset="1" col-lg="10">
                                                <c:choose>
                                                    <c:when test="#{pedidoCT.descripcionPedido.estado.idEstado == 3}">
                                                        <div class="callout callout-info" >
                                                            <i class=" fa fa-4x fa-tag"/>
                                                            <h4 style="float:right; vertical-align: central">Servicio Solicitado</h4>
                                                        </div>
                                                    </c:when>
                                                    <c:when test="#{pedidoCT.descripcionPedido.estado.idEstado == 4}">
                                                        <div class="callout callout-success" >
                                                            <i class=" fa fa-4x fa-check-square"/>
                                                            <h4 style="float:right; vertical-align: central">Prendas Recibidas</h4>
                                                        </div>
                                                    </c:when>
                                                    <c:when test="#{pedidoCT.descripcionPedido.estado.idEstado == 5}">
                                                        <div class="callout callout-warning" >
                                                            <i class=" fa fa-4x fa-building"/>
                                                            <h4 style="float:right; vertical-align: central">En Planta</h4>
                                                        </div>
                                                    </c:when>
                                                    <c:when test="#{pedidoCT.descripcionPedido.estado.idEstado == 6}">
                                                        <div class="callout callout-info" >
                                                            <i class=" fa fa-4x fa-tint"/>
                                                            <h4 style="float:right; vertical-align: central">Lavado</h4>
                                                        </div>
                                                    </c:when>
                                                    <c:when test="#{pedidoCT.descripcionPedido.estado.idEstado == 7}">
                                                        <div class="callout callout-info" >
                                                            <i class=" fa fa-4x fa-check"/>
                                                            <h4 style="float:right; vertical-align: central">Entregado</h4>
                                                        </div>
                                                    </c:when>                                                                    
                                                </c:choose>
                                            </b:column>
                                            <b:column offset="1" col-lg="10">
                                                <div class="box box-info">
                                                    <div class="box-header">                                                        
                                                    </div>
                                                    <div class="box-body">
                                                        <table width="100%">
                                                            <tr>
                                                                <td width="50%" align="center">
                                                                    <p:graphicImage value="#{pedidoCT.descripcionPedido.subProducto.rutaImagen}" width="250px" height="280px"/> 
                                                                </td>
                                                                <td width="50%" >
                                                                    <h:panelGrid columns="1" width="100%">                                                                        
                                                                        <p:outputLabel value="Codigo" for="TCodigo"/>
                                                                        <p:inputText class="form-control" maxlength="60" disabled="#{pedidoCT.descripcionPrenda}" id="TCodigo" required="true" requiredMessage="Ingrese nombres" placeholder="Codigo de la prenda" value="#{pedidoCT.descripcionPedido.codigo}" style="width: 100%;"></p:inputText>                       
                                                                        <p:message for="TCodigo"/>

                                                                        <p:outputLabel value="Color" for="SMColor"/>
                                                                        <h:selectOneMenu disabled="#{pedidoCT.descripcionPrenda}" value="#{pedidoCT.descripcionPedido.color.nombre}" id="SMColor" class="form-control">
                                                                            <f:selectItem itemLabel="Seleccione Color" noSelectionOption="true"/>
                                                                            <f:selectItems value="#{colorCT.colores}" var="color" itemLabel="#{color.nombre}" itemValue="#{color.nombre}"/>
                                                                        </h:selectOneMenu>
                                                                        <p:message for="SMColor"/>

                                                                        <p:outputLabel value="Descripcion" for="TDescripcion"/>
                                                                        <p:inputTextarea disabled="#{pedidoCT.descripcionPrenda}" class="form-control" rows="4" maxlength="200" id="TDescripcion" required="true" requiredMessage="Ingrese Descripcion" placeholder="Descripcion de la prenda" value="#{pedidoCT.descripcionPedido.descripcion}" style="width: 100%;"></p:inputTextarea>                       
                                                                        <p:message for="TDescripcion"/>

                                                                        <p:separator/>
                                                                        <p:commandButton icon="fa fa-calendar" immediate="true" iconPos="right" action="#{historicoCT.verHistoricoPrenda(pedidoCT.descripcionPedido)}" style="float: right" class="btn btn-warning" value="Ver Historico"/>
                                                                    </h:panelGrid>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>
                                            </b:column>
                                            <b:column offset="1" col-lg="10">
                                                <div class="box box-success">
                                                    <div align="center" class="box-body">
                                                        <!--                                                        <p:galleria value="" var="" panelWidth="500" panelHeight="313" showCaption="true">
                                                                                                                    <p:graphicImage name="" alt="" title=""/>
                                                                                                                </p:galleria>-->
                                                        <h:panelGrid width="100%" columns="1">
                                                            <p:outputLabel value="Observacion Asesor" for="TObservacionA"/>
                                                            <p:inputTextarea class="form-control" rows="4" maxlength="200" id="TObservacionA" required="true" requiredMessage="Ingrese Descripcion" placeholder="Observacion del asesor" value="#{pedidoCT.descripcionPedido.observacionAsesor}" style="width: 100%;"></p:inputTextarea>                       
                                                            <p:message for="TObservacionA"/>

                                                            <p:outputLabel value="Observacion Planta" for="TObservacionP"/>
                                                            <p:inputTextarea  class="form-control" rows="4" maxlength="200" id="TObservacionP" required="true" requiredMessage="Ingrese Descripcion" placeholder="Observacion de la planta" value="#{pedidoCT.descripcionPedido.observacionAdministrador}" style="width: 100%;"></p:inputTextarea>                       
                                                            <p:message for="TObservacionP"/>
                                                        </h:panelGrid>                                                
                                                    </div>
                                                </div>                                                
                                            </b:column>
                                        </div>
                                        <div class="box-footer">
                                            <b:column offset="1" col-lg="10">
                                                <p:commandButton immediate="true" icon="fa fa-arrow-left" onclick="PrimeFaces.monitorDownload(start, stop);" 
                                                                 action="#{pedidoCT.volverPedido()}" update=":formularioRegistro" value="Regresar" style="width: 20%" class="btn btn-info"/>
                                            </b:column>
                                        </div>
                                    </div>
                                </b:column>
                            </c:when>
                        </c:choose>
                        <script type="text/javascript">
                            function start() {
                                PF('statusDialog').show();
                            }
                            function stop() {
                                PF('statusDialog').hide();
                            }
                        </script>
                        <p:dialog id="dialog" modal="true" widgetVar="statusDialog" header="Cargando..." draggable="false" closable="false" resizable="false">
                            <p:graphicImage width="100%" value="/resources/images/demo/ajaxloadingbar.gif" />
                        </p:dialog>
                    </h:form>
                </b:row>
            </b:container>         
        </ui:define>
    </ui:composition>
</html>
